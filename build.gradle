description = 'Spring Integration Scala DSL Samples'

apply plugin: 'base'
apply plugin: 'idea'

allprojects {
  group = 'org.springframework.integration.scala.dsl.samples'

 logging.captureStandardOutput LogLevel.DEBUG
  repositories {
  mavenLocal()  
  mavenCentral()
    maven { url 'http://repo.springsource.org/libs-milestone' }
    maven { url 'https://repo.springsource.org/libs-snapshot'}
    maven { url 'https://repo.springsource.org/libs-release'}
    maven { url 'https://repo.springsource.org/libs-milestone'}
  }
}

subprojects { subproject ->
   
  apply plugin: 'scala'
  apply plugin: 'maven'
  apply plugin: 'eclipse'
  apply plugin: 'idea'

  sourceCompatibility=1.5
  targetCompatibility=1.5

  junitVersion = '4.8.2'
  log4jVersion = '1.2.12'
  mockitoVersion = '1.9.0'

  compileScala {
    compileScala.scalaCompileOptions.additionalParameters= ['-feature']
    compileScala.scalaCompileOptions.additionalParameters= ['-language:existentials']
  }

  compileTestScala {
    compileTestScala.scalaCompileOptions.additionalParameters= ['-feature']
    compileTestScala.scalaCompileOptions.additionalParameters= ['-language:reflectiveCalls']
  }

  install {
      repositories.mavenInstaller {
          customizePom(pom, subproject)
      }
  }

  task sourcesJar(type: Jar, dependsOn: scaladoc) {
    classifier = 'sources'
  }

  artifacts {
    archives sourcesJar
  }

  // dependencies that are common across all java projects
  dependencies {

	// Libraries needed for scala api
    compile 'org.scala-lang:scala-library:2.10.0'

    compile 'org.scala-lang:scala-reflect:2.10.0'

	// Libraries needed to run the scala tools
    scalaTools 'org.scala-lang:scala-compiler:2.10.0'
    scalaTools 'org.scala-lang:scala-library:2.10.0'

	compile 'org.scala-lang:scala-compiler:2.10.0'
    compile 'org.scala-lang:scala-library:2.10.0'

    compile "org.springframework.integration:spring-integration-dsl-scala-core:1.0.0.BUILD-SNAPSHOT"

//    testCompile "junit:junit-dep:$junitVersion"
  //  testCompile "log4j:log4j:$log4jVersion"
   // testCompile "org.mockito:mockito-all:$mockitoVersion"
    //testCompile 'com.novocode:junit-interface:0.7'
  }
}

project('basic') {
  description = 'Spring Integration Scala DSL Basic Samples'
}

task wrapper(type: Wrapper) {
    description = 'Generates gradlew[.bat] scripts'
    gradleVersion = '1.0-milestone-8'
    distributionUrl = 'http://repo.gradle.org/gradle/distributions-snapshots/gradle-1.0-milestone-8-20120112000036+0100-bin.zip'
    jarFile = '.wrapper/gradle-wrapper.jar'
}

def customizePom(def pom, def gradleProject) {
    pom.whenConfigured { generatedPom ->
        // respect 'optional' and 'provided' dependencies
        def deps = gradleProject.configurations.runtime.allDependencies
        def optionalDeps = deps.findAll { dep ->
            dep.asDynamicObject.hasProperty('optional') && dep.optional
        }
        def providedDeps = deps.findAll { dep ->
            dep.asDynamicObject.hasProperty('provided') && dep.provided
        }
        generatedPom.dependencies.each { mavenDep ->
            mavenDep.optional = optionalDeps.any { optionalDep ->
                optionalDep.group == mavenDep.groupId &&
                        optionalDep.name == mavenDep.artifactId &&
                        optionalDep.version == mavenDep.version
            }
            boolean isProvided = providedDeps.any { providedDep ->
                providedDep.group == mavenDep.groupId &&
                        providedDep.name == mavenDep.artifactId &&
                        providedDep.version == mavenDep.version
            }
            if (isProvided) {
                mavenDep.scope = 'provided'
            }
        }

        // eliminate test-scoped dependencies (no need in maven central poms)
        generatedPom.dependencies.removeAll { dep ->
            dep.scope == 'test'
        }

        // add all items necessary for maven central publication
        generatedPom.project {
            name = gradleProject.description
            description = gradleProject.description
            url = 'https://github.com/SpringSource/spring-integration-scala'
            organization {
                name = 'SpringSource'
                url = 'http://springsource.org'
            }
            licenses {
                license {
                    name 'The Apache Software License, Version 2.0'
                    url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                    distribution 'repo'
                }
            }
            scm {
                url = 'https://github.com/SpringSource/spring-integration-dsl-scala'
                connection = 'scm:git:git://github.com/SpringSource/spring-integration-dsl-scala'
                developerConnection = 'scm:git:git://github.com/SpringSource/spring-integration-dsl-scala'
            }
            developers {
                developer {
                    id = 'olegz'
                    name = 'Oleg Zhurakousky'
                    email = 'ozhurakousky@vmware.com'
                }
            }
        }
    }
}

task scaladoc(type: org.gradle.api.tasks.scala.ScalaDoc) {
	group = 'Documentation'
	description = 'Generates aggregated ScalaDoc API documentation.'
	title = "${rootProject.description} ${version} API"
	source subprojects.collect { project ->
		project.sourceSets.main.allScala
	}
	destinationDir = new File(buildDir, "api")
	scalaClasspath = files(subprojects.collect { project ->
		project.sourceSets.main.compileClasspath
	})
	classpath = files(subprojects.collect { project ->
		project.sourceSets.main.compileClasspath
	})
}
